# For my  dissertation for Malware analysis using ML 
#!/bin/bash

# Output folder to store the malware files
output_folder="njrat_malware_new"

# Check if hash file exists
if [ ! -f "njRAT_hashes_new" ]; then
    echo "Hash file not found."
    exit 1
fi

# Create output folder if it doesn't exist ==> save it in a safe place
mkdir -p "$output_folder"

# Control the number of files to be downloaded
limit=1000  # Change this value to the desired number of downloads

# initial count 
count=0


while IFS= read -r hash && [ $count -lt $limit ]; do
    # Use curl to download the sample for each hash value
    curl -s -XPOST -d "query=get_file&sha256_hash=${hash}" -o "${output_folder}/${hash}.zip" https://mb-api.abuse.ch/api/v1/
    echo "Downloaded malware sample for hash: ${hash}"
    ((count++))
done < njRAT_hashes_new

# Create a folder to store extracted files
extracted_folder="extracted_malware"
mkdir -p "$extracted_folder"

# Unzip the files using infected password
infected_password="infected"

# Loop through each zip file and extract it
for file in "${output_folder}"/*.zip; do
    filename=$(basename -- "$file")
    unzip -P "$infected_password" "$file" -d "${extracted_folder}/${filename%.*}"
done

# Loop through each file in the output folder and zip it
for file in "${output_folder}"/*; do
    if [ -f "$file" ]; then
        filename=$(basename -- "$file")
        zip -r -Z deflate -0 "${output_folder}/${filename}.zip" "$file"
    fi
done

